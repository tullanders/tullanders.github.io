<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Damage sites in Gaza 2024-07-06 - Anders Bergkvist</title>
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
    <script src="https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body {
          width: 100vw;
          height: 100vh;
          margin: 0;
        }
    </style>
</head>
<body>
  <div id="map"></div>
  <script>
    const {DeckGL, GeoJsonLayer, FlyToInterpolator} = deck;
    let map;

    // The viewstates:
    let initialViewState = {
      zoom: 11,      
      longitude: 34.4667,
      latitude: 31.5,
      pitch: 0
    };

    const viewState2 = () => {
      initialViewState = {
        ...initialViewState,
        bearing: 0,
        transitionDuration: 20000,
        zoom: 4.5,
        latitude: 60,
        pitch: 40,
        transitionInterpolator: new FlyToInterpolator(['bearing']),
        onTransitionEnd: viewState3
      };
      map.setProps({initialViewState});
    }
    const viewState3 = () => {
        initialViewState = {
        ...initialViewState,
        bearing: 0,
        longitude: 16,
        transitionDuration: 30000,
        zoom:4.8,
        transitionInterpolator: new FlyToInterpolator(['bearing']),
      };
      map.setProps({initialViewState});
    }      

    const layer = new GeoJsonLayer({
      id: 'GeoJsonLayer',
      data: './damage_gaza.json',

      stroked: false,
      filled: true,
      pointType: 'circle+text',
      pickable: true,
      //getFillColor: [160, 160, 180, 200],
      getFillColor: f => {
        if (f.properties.Main_Damage_Site_Class[7] == 5) {
          return [255, 0, 0, 255];
        }
        else if (f.properties.Main_Damage_Site_Class[7] == 4) {
          return [255, 50, 0, 255];
        }
        else if (f.properties.Main_Damage_Site_Class[7] == 3) {
          return [255, 100, 0, 255];
        }
        else if (f.properties.Main_Damage_Site_Class[7] == 2) {
          return [255, 150, 0, 255];
        }
        else if (f.properties.Main_Damage_Site_Class[7] == 1) {
          return [255, 200, 0, 255];
        }
        else {
          return [255, 255, 50, 255];
        }
      },
      getLineColor: f => {
        const hex = f.properties.color;
        // convert to RGB
        return hex ? hex.match(/[0-9a-f]{2}/g).map(x => parseInt(x, 16)) : [0, 0, 0];
      },
      getLineWidth: 20,
      getPointRadius: 4,
      getText: f => f.properties.name,
      getTextSize: 12
    });    

    map = new DeckGL({
      //mapStyle: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
      mapStyle: 'https://raw.githubusercontent.com/CartoDB/basemap-styles/master/mapboxgl/dark-matter-nolabels.json',
      initialViewState: initialViewState,
      controller: true,
      layers: [layer],
      getTooltip: ({object}) => object && object.properties.Main_Damage_Site_Class[7] + ' ' + object.properties.Municipality,
      //onLoad: viewState2
    });


      
</script>

</body>
</html>
