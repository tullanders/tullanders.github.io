<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trains 28 August 2024 - Anders Bergkvist</title>
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
    <script src="https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.0.0/dist/maplibre-gl.css" rel="stylesheet" />
    <style>
        body {
          width: 100vw;
          height: 100vh;
          margin: 0;
        }
    </style>
<script type="text/javascript">
  (function(c,l,a,r,i,t,y){
      c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
      t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
      y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
  })(window, document, "clarity", "script", "ofkf3m7mly");
</script>       
</head>
<body>
  <div id="map"></div>
  <script>
    const {DeckGL, TripsLayer, FlyToInterpolator} = deck;
    let map;

    // The viewstates:
    let initialViewState = {
      zoom: 4,
      longitude: 18.6435,
      latitude: 63.1282,
      pitch: 0
    };

    const viewState2 = () => {
      initialViewState = {
        ...initialViewState,
        bearing: 0,
        transitionDuration: 20000,
        zoom: 4.5,
        latitude: 60,
        pitch: 40,
        transitionInterpolator: new FlyToInterpolator(['bearing']),
        onTransitionEnd: viewState3
      };
      map.setProps({initialViewState});
    }
    const viewState3 = () => {
        initialViewState = {
        ...initialViewState,
        bearing: 0,
        longitude: 16,
        transitionDuration: 30000,
        zoom:4.8,
        transitionInterpolator: new FlyToInterpolator(['bearing']),
      };
      map.setProps({initialViewState});
    }      

    map = new DeckGL({
      //mapStyle: 'https://basemaps.cartocdn.com/gl/dark-matter-gl-style/style.json',
      mapStyle: 'https://raw.githubusercontent.com/CartoDB/basemap-styles/master/mapboxgl/dark-matter-nolabels.json',
      initialViewState: initialViewState,
      controller: true,
      onLoad: viewState2
    });

    const DATA_URL = "./trains.json";
    const LOOP_LENGTH = 3000;

  let currentTime = 0;
  let deltaTime = 0;

    const animate = (timestamp) => {
      currentTime = (currentTime + 0.6) % LOOP_LENGTH;
      map.setProps({
        layers: [
          new TripsLayer(
            {
            id: "trips",
            data: DATA_URL,
            getPath: (d) => d.path,
            getTimestamps: (d) => d.timestamps,
            getColor: [191, 255, 0],
            opacity: 1,
            widthMinPixels: 2,
            trailLength: 60,
            currentTime,
            shadowEnabled: false,
            currentTime,
          })
        ]
      });
      window.requestAnimationFrame(animate);
    };
    window.requestAnimationFrame(animate);
      
</script>

</body>
</html>
